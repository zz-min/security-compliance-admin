# Security Compliance Admin — 유스케이스 명세 (v0.1)
보안성 심사 대응용 어드민 시스템  

## 목차
- [Security Compliance Admin — 유스케이스 명세 (v0.1)](#security-compliance-admin--유스케이스-명세-v01)
  - [목차](#목차)
  - [0. 문서 메타](#0-문서-메타)
  - [1. 개요](#1-개요)
  - [2. 유스케이스 목록](#2-유스케이스-목록)
  - [3. 상세 유스케이스](#3-상세-유스케이스)
    - [3.1 UC-001 로그인 + 2FA](#31-uc-001-로그인--2fa)
    - [3.2 UC-002 세션 자동 로그아웃](#32-uc-002-세션-자동-로그아웃)
    - [3.3 UC-003 비밀번호 변경/주기](#33-uc-003-비밀번호-변경주기)
    - [3.4 UC-004 감사 로그 조회/CSV](#34-uc-004-감사-로그-조회csv)
    - [3.5 UC-005 API Key 관리](#35-uc-005-api-key-관리)
    - [3.6 UC-006 파일 다운로드 관리](#36-uc-006-파일-다운로드-관리)
    - [3.7 UC-007 운영 통계 대시보드](#37-uc-007-운영-통계-대시보드)
    - [3.8 UC-008 운영 로그 대시보드](#38-uc-008-운영-로그-대시보드)
  - [4. 참조 문서](#4-참조-문서)
  - [5. 부록: 에러 코드](#5-부록-에러-코드)
    - [5.1 표준 HTTP 상태 코드](#51-표준-http-상태-코드)
    - [5.2 커스텀 에러 코드 (응답 `error.code` 필드에 포함)](#52-커스텀-에러-코드-응답-errorcode-필드에-포함)
      - [5.2.1 인증/세션 관련](#521-인증세션-관련)
      - [5.2.2 비밀번호 관리 관련](#522-비밀번호-관리-관련)
      - [5.2.3 권한/접근 제어 관련](#523-권한접근-제어-관련)
      - [5.2.4 API Key 관리 관련](#524-api-key-관리-관련)
      - [5.2.5 파일/리소스 관련](#525-파일리소스-관련)
      - [5.2.6 시스템 오류 관련](#526-시스템-오류-관련)
      - [5.2.7 요청 검증 관련](#527-요청-검증-관련)

## 0. 문서 메타
- 문서 버전: v0.1 (2025-09-03)
- 문서 소유자: 김지민
- 변경이력:
  - v0.1 (2025-09-03) 초안 작성

## 1. 개요
- 목적: 요구사항명세(01_requirements.md) 기반으로 **기능 단위 유스케이스 흐름**을 정의
- 범위: MVP 기능 (FR-001 ~ FR-070)

## 2. 유스케이스 목록
| UC-ID  | 이름               | 관련 FR    |
| ------ | ------------------ | ---------- |
| UC-001 | 로그인 + 2FA       | FR-001     |
| UC-002 | 세션 자동 로그아웃 | FR-002     |
| UC-003 | 비밀번호 변경/주기 | FR-003/004 |
| UC-004 | 감사 로그 조회/CSV | FR-030     |
| UC-005 | API Key 관리       | FR-040     |
| UC-006 | 파일 다운로드 관리 | FR-050     |
| UC-007 | 운영 통계 대시보드 | FR-060     |
| UC-008 | 운영 로그 대시보드 | FR-070     |

## 3. 상세 유스케이스

### 3.1 UC-001 로그인 + 2FA
- **액터**: 모든 사용자
- **사전조건**: 사용자 계정 생성됨, TOTP 등록 완료, 사용자 계정 상태가 ACTIVE 또는 PASSWORD_EXPIRED
- **사후조건**:
	1. 성공시
		- 유효한 사용자 세션 생성
		- 지정된 그룹의 메인 화면으로 이동
		- 최종 로그인 시간 업데이트
		- 로그인 실패횟수 초기화
		- 성공 로그인 감사로그기록
	2. 실패시
		- 세션생성 X
		- 계속 로그인 화면 유지
		- 실패 로그인 감사로그기록(E1, E4, E5, A1)
- **시나리오**:
  1. 사용자가 ID/PW 입력후 로그인 버튼
  2. 서버가 ID 검증 -> PW검증 -> 계정상태 확인(ACTIVE/INACTIVE/PASSWORD_EXPIRED/LOCKED)
  3. 사용자에게 TOTP 입력 요청
  4. 올바른 TOTP 제출 
  5. 서버가 TOTP코드검증
- **예외**:
  - [E1] 존재하지 않는 ID 
	  - 응답: `401 Unauthorized` (`AUTH_ID_NOT_FOUND`)
	  - 로그인 실패 메시지 표시, 감사 로그 기록
  - [E2] 비밀번호 검증 실패 
	  - 응답: `401 Unauthorized`(`AUTH_PASSWORD_INVALID`)
	  - 실패 횟수 누적, 에러 메시지 표시, (일반적인 실패 → 노이즈 방지로 감사로그기록X)
  - [E3] TOTP 검증 실패 → 실패 횟수 누적, 에러 메시지 표시
	  - 응답: `401 Unauthorized`(`AUTH_TOTP_INVALID`)
	  - 실패 횟수 누적, 에러 메시지 표시, (일반적인 실패 → 노이즈 방지로 감사로그기록X)
  - [E4] 비밀번호/OTP 연속 5회 실패
	  - 응답: `423 Locked` (`AUTH_ACCOUNT_LOCKED`)
	  - 에러 메시지 표시, 계정 `LOCKED`, 감사 로그 기록
  - [E5] 정상 ID/PW 및 TOTP 통과했으나 계정 `INACTIVE` 상태
	  - 응답: `403 Forbidden` (`AUTH_ACCOUNT_INACTIVE`)
	  - 에러 메시지 표시, 로그인 거부, 감사 로그 기록
- **대체 시나리오 (Alternative Flow)**:
  - [A1] 정상 ID/PW 및 TOTP 통과했으나 **비밀번호 변경주기 90일 경과**  
	  - 응답: `403 Forbidden` (`AUTH_PASSWORD_EXPIRED`)
	  - 비밀번호 변경 플로우 진입, 팝업 안내 -> 비밀번호변경 -> 재로그인, 감사 로그 기록

### 3.2 UC-002 세션 자동 로그아웃
- **액터**: 로그인된 사용자
- **사전조건**: 세션 활성 상태
- **사후조건**:
	1. 성공시
		- 세션 만료 처리
		- 사용자 로그인 화면으로 리다이렉트
		- 세션 만료 감사로그 기록
	2. 실패시
		- 세션 상태 불명 처리
		- 시스템 오류 로그 기록
- **시나리오**:
  1. 사용자가 로그인 후 일정 시간(Idle 30분) 동안 요청 없음  
  2. 서버가 세션 만료 처리 (`SESSION_EXPIRED`)  
  3. 사용자가 만료된 세션으로 요청 시 → `401 Unauthorized` 응답  
  4. 감사 로그에 세션 만료 이벤트 기록  
- **예외**:
  - [E1] 세션 쿠키 위·변조 
	  - 응답: `401 Unauthorized`
	  - 세션 무효화, 감사 로그 기록  
  - [E2] 세션 스토리지(redis) 장애로 세션 확인 불가 
	  - 응답: `500 Internal Server Error`
	  - 시스템 오류 로그 기록  
- **대체 시나리오**:
  - [A1] 관리자가 강제 로그아웃 수행  
	  - 해당 사용자의 세션 즉시 만료
	  - 다음 요청 시 `401 Unauthorized`
	  - 관리자 액션 감사 로그 기록 

### 3.3 UC-003 비밀번호 변경/주기
- **액터**: 모든 사용자
- **사전조건**: 계정 존재, 로그인 상태 또는 비밀번호 변경 필요 상태
- **사후조건**:
	1. 성공시
		- 새로운 비밀번호로 업데이트
		- 비밀번호 변경일시 갱신
		- 비밀번호 변경 감사로그 기록
	2. 실패시
		- 기존 비밀번호 유지
		- 정책 위반 에러 메시지 표시
- **시나리오**:
  1. 사용자가 현재 비밀번호 입력
  2. 사용자가 새 비밀번호 입력 및 확인
  3. 서버가 비밀번호 정책 검증 (최소 8자, 복잡도 등)
  4. 서버가 최근 5개 비밀번호와 중복 검사
  5. 서버가 Argon2id로 해시화하여 저장
- **예외**:
  - [E1] 현재 비밀번호 불일치
	  - 응답: `401 Unauthorized`
	  - 에러 메시지 표시
  - [E2] 비밀번호 정책 위반 (복잡도, 길이 등)
	  - 응답: `422 Unprocessable Entity`
	  - 정책 상세 안내 메시지 표시
  - [E3] 최근 5개 비밀번호와 중복
	  - 응답: `422 Unprocessable Entity`
	  - 재사용 불가 메시지 표시
- **대체 시나리오**:
  - [A1] 90일 경과로 인한 강제 변경
	  - 로그인 시 비밀번호 변경 팝업 노출
	  - 변경 완료 후 정상 로그인 진행

### 3.4 UC-004 감사 로그 조회/CSV
- **액터**: AUDITOR, ADMIN
- **사전조건**: 적절한 권한으로 로그인 완료
- **사후조건**:
	1. 성공시
		- 필터 조건에 맞는 감사 로그 반환
		- CSV 파일 생성 및 다운로드 제공
		- 조회 액션 감사로그 기록
	2. 실패시
		- 빈 결과 또는 권한 에러
		- 접근 거부 감사로그 기록
- **시나리오**:
  1. 사용자가 조회 조건 설정 (기간, 사용자ID, 액션 타입 등)
  2. 서버가 권한 확인 (AUDITOR/ADMIN 여부)
  3. 서버가 조건에 맞는 감사 로그 검색
  4. 페이징된 결과를 화면에 표시
  5. 사용자가 CSV 내보내기 요청 시 파일 생성
- **예외**:
  - [E1] 무권한 사용자 접근
	  - 응답: `403 Forbidden`
	  - 권한 부족 메시지 표시, 감사 로그 기록
  - [E2] 잘못된 조회 조건
	  - 응답: `400 Bad Request`
	  - 조건 오류 메시지 표시
- **대체 시나리오**:
  - [A1] 대용량 데이터 조회 요청
	  - 백그라운드 CSV 생성 후 이메일 전송
	  - 진행 상황 알림 제공

### 3.5 UC-005 API Key 관리
- **액터**: ADMIN
- **사전조건**: ADMIN 권한으로 로그인 완료
- **사후조건**:
	1. 성공시
		- API Key 발급/회전/폐기 완료
		- Key 상태 변경 감사로그 기록
	2. 실패시
		- 기존 Key 상태 유지
		- 조건 불충족 에러 메시지 표시
- **시나리오**:
  1. 사용자가 API Key 관리 메뉴 접근
  2. 기존 Key 목록 조회 (prefix + 마스킹 처리)
  3. 신규 발급/회전/폐기 중 선택
  4. 발급 시 → 새 Key 생성, 최초 1회 전체 노출
  5. 회전/폐기 시 → 기존 Key 상태 변경
- **예외**:
  - [E1] 무권한 사용자 접근
	  - 응답: `403 Forbidden`
	  - 권한 부족 메시지 표시
  - [E2] Key 회전 조건 불일치 (생성 후 24시간 미경과 등)
	  - 응답: `409 Conflict` (`APIKEY_CONFLICT`)
	  - 조건 불충족 메시지 표시
- **대체 시나리오**:
  - [A1] 긴급 Key 폐기
	  - 즉시 폐기 처리, 관련 세션 무효화
	  - 긴급 액션 감사로그 기록

### 3.6 UC-006 파일 다운로드 관리
- **액터**: DEVELOPER, ADMIN
- **사전조건**: 적절한 권한으로 로그인 완료, 다운로드 대상 파일 존재
- **사후조건**:
	1. 성공시
		- 파일 다운로드 완료
		- 다운로드 이력 운영로그 기록
	2. 실패시
		- 다운로드 거부
		- 접근 거부 운영로그 기록
- **시나리오**:
  1. 사용자가 파일 다운로드 요청
  2. 서버가 사용자 권한 확인 (DEVELOPER/ADMIN)
  3. 서버가 조직 범위 권한 확인 (사용자별 접근 가능 고객사)
  4. 권한 확인 완료 시 파일 전송
  5. 다운로드 완료 후 운영 로그 기록
- **예외**:
  - [E1] 무권한 사용자 접근
	  - 응답: `403 Forbidden` (`DOWNLOAD_DENIED`)
	  - 권한 부족 메시지 표시, 운영로그 기록
  - [E2] 조직 범위 권한 부족
	  - 응답: `403 Forbidden` (`DOWNLOAD_DENIED`)
	  - 범위 초과 메시지 표시, 운영로그 기록
  - [E3] 파일 없음 또는 삭제됨
	  - 응답: `404 Not Found`
	  - 파일 없음 메시지 표시
- **대체 시나리오**:
  - [A1] 대용량 파일 다운로드
	  - 스트리밍 다운로드 또는 분할 전송
	  - 진행률 표시 제공

### 3.7 UC-007 운영 통계 대시보드
- **액터**: OPERATOR, ADMIN
- **사전조건**: 적절한 권한으로 로그인 완료
- **사후조건**:
	1. 성공시
		- 통계 데이터 차트/표 형태로 표시
		- CSV 내보내기 가능
		- 조회 액션 운영로그 기록
	2. 실패시
		- 빈 데이터 또는 권한 에러
		- 접근 거부 운영로그 기록
- **시나리오**:
  1. 사용자가 조회 조건 설정 (고객사, 기간)
  2. 서버가 권한 확인 (OPERATOR/ADMIN)
  3. API 호출 건수, 성공·실패율, 시간대별 오류율 조회
  4. 차트 및 테이블 형태로 데이터 시각화
  5. CSV 내보내기 요청 시 파일 생성
- **예외**:
  - [E1] 무권한 사용자 접근
	  - 응답: `403 Forbidden`
	  - 권한 부족 메시지 표시, 운영로그 기록
  - [E2] 통계 데이터 수집 실패
	  - 응답: `500 Internal Server Error`
	  - 일시적 오류 메시지 표시
- **대체 시나리오**:
  - [A1] 실시간 모니터링 모드
	  - 자동 갱신 설정으로 주기적 데이터 업데이트
	  - WebSocket 또는 폴링 방식 활용

### 3.8 UC-008 운영 로그 대시보드
- **액터**: DEVELOPER, ADMIN
- **사전조건**: 적절한 권한으로 로그인 완료
- **사후조건**:
	1. 성공시
		- 운영 로그 데이터 조회 및 표시
		- CSV 내보내기 가능
		- 조회 액션 운영로그 기록
	2. 실패시
		- 빈 데이터 또는 권한 에러
		- 접근 거부 운영로그 기록
- **시나리오**:
  1. 사용자가 조회 조건 설정 (사용자별, 기간, 액션 타입)
  2. 서버가 권한 확인 (DEVELOPER/ADMIN)
  3. 다운로드 요청/실행 이력, 실패/거부 내역, 고객사별 접근 로그 조회
  4. 테이블 형태로 데이터 표시
  5. CSV 내보내기 요청 시 파일 생성
- **예외**:
  - [E1] 무권한 사용자 접근
	  - 응답: `403 Forbidden`
	  - 권한 부족 메시지 표시, 운영로그 기록
  - [E2] 조회 조건 오류
	  - 응답: `400 Bad Request`
	  - 조건 수정 안내 메시지 표시
- **대체 시나리오**:
  - [A1] 특정 사용자 상세 이력 조회
	  - 사용자별 모든 액션 타임라인 제공
	  - 드릴다운 방식으로 상세 정보 확인

## 4. 참조 문서
- [01_requirements.md - 요구사항 명세서](./01_requirements.md)
- 추후 아키텍처 설계(03_architecture.md), DB 설계(04_db_erd.md)와 연결 예정
## 5. 부록: 에러 코드

### 5.1 표준 HTTP 상태 코드
- **400 Bad Request**: 잘못된 요청 파라미터 또는 조회 조건
- **401 Unauthorized**: 인증 실패 / 세션 만료 / 비밀번호 불일치
- **403 Forbidden**: 권한 부족, RBAC·ABAC 위반, 계정 상태 문제
- **404 Not Found**: 요청한 리소스(파일 등)가 존재하지 않음
- **409 Conflict**: 자원 상태 충돌 (예: API Key 회전 조건 불일치)
- **422 Unprocessable Entity**: 정책 위반 (비밀번호 규칙 불충족, 재사용 등)
- **423 Locked**: 리소스(계정 등)가 잠긴 상태 (로그인 실패 5회 누적 등)
- **500 Internal Server Error**: 시스템 내부 오류 (세션 스토리지 장애, 통계 데이터 수집 실패 등)

### 5.2 커스텀 에러 코드 (응답 `error.code` 필드에 포함)

#### 5.2.1 인증/세션 관련
- **AUTH_ID_NOT_FOUND**: 존재하지 않는 사용자 ID (`401 Unauthorized`)
- **AUTH_PASSWORD_INVALID**: 비밀번호 검증 실패 (`401 Unauthorized`)
- **AUTH_TOTP_INVALID**: 잘못된 TOTP 코드 (`401 Unauthorized`)
- **AUTH_ACCOUNT_LOCKED**: 로그인 실패 5회로 계정 잠금 (`423 Locked`)
- **AUTH_ACCOUNT_INACTIVE**: 계정이 `INACTIVE` 상태여서 로그인 거부 (`403 Forbidden`)
- **AUTH_PASSWORD_EXPIRED**: 비밀번호 변경 주기(90일) 초과로 로그인 거부 (`403 Forbidden`)
- **SESSION_EXPIRED**: 세션 만료 (Idle Timeout 30분) (`401 Unauthorized`)

#### 5.2.2 비밀번호 관리 관련
- **PASSWORD_POLICY_VIOLATION**: 비밀번호 정책 위반 (복잡도, 길이 등) (`422 Unprocessable Entity`)
- **PASSWORD_REUSE_DENIED**: 최근 5개 비밀번호와 중복 (`422 Unprocessable Entity`)

#### 5.2.3 권한/접근 제어 관련
- **ACCESS_DENIED**: 일반적인 권한 부족 (`403 Forbidden`)
- **DOWNLOAD_DENIED**: 파일 다운로드 권한 없음 (`403 Forbidden`)
- **AUDIT_ACCESS_DENIED**: 감사 로그 조회 권한 없음 (`403 Forbidden`)
- **STATS_ACCESS_DENIED**: 운영 통계 조회 권한 없음 (`403 Forbidden`)
- **LOGS_ACCESS_DENIED**: 운영 로그 조회 권한 없음 (`403 Forbidden`)

#### 5.2.4 API Key 관리 관련
- **APIKEY_CONFLICT**: API Key 회전 조건 불일치 (`409 Conflict`)
- **APIKEY_ACCESS_DENIED**: API Key 관리 권한 없음 (`403 Forbidden`)

#### 5.2.5 파일/리소스 관련
- **FILE_NOT_FOUND**: 요청한 파일이 존재하지 않음 (`404 Not Found`)
- **FILE_ACCESS_DENIED**: 조직 범위 권한 부족으로 파일 접근 불가 (`403 Forbidden`)

#### 5.2.6 시스템 오류 관련
- **SESSION_STORAGE_ERROR**: 세션 스토리지(Redis) 장애 (`500 Internal Server Error`)
- **STATS_COLLECTION_ERROR**: 통계 데이터 수집 실패 (`500 Internal Server Error`)
- **SYSTEM_ERROR**: 일반적인 시스템 내부 오류 (`500 Internal Server Error`)

#### 5.2.7 요청 검증 관련
- **INVALID_REQUEST_PARAMS**: 잘못된 요청 파라미터 (`400 Bad Request`)
- **INVALID_SEARCH_CONDITION**: 잘못된 조회 조건 (`400 Bad Request`)